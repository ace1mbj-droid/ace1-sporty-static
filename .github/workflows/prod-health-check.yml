name: Production health check

on:
  workflow_dispatch: {}
  schedule:
    # Run every 1 hour
    - cron: '0 * * * *'

jobs:
  check-health:
    runs-on: ubuntu-latest
    env:
      # Provide a site URL via secret SITE_HEALTH_URL (optional)
      HEALTHCHECK_URL: ${{ secrets.SITE_HEALTH_URL }}
    steps:
      - name: Check site health endpoint
        run: |
          echo "Pinging production health endpoint: $HEALTHCHECK_URL"
          # Fail the job if response is non-200
          CHECK_URL=${HEALTHCHECK_URL:-https://ace1.in/health}
          echo "Resolved check url: $CHECK_URL"
          status=$(curl --write-out "%{http_code}" --silent --output /dev/null "$CHECK_URL" || true)
          echo "Status returned: $status"
          if [ "$status" != "200" ]; then
            echo "Health check failed (HTTP $status)"
            exit 1
          fi
