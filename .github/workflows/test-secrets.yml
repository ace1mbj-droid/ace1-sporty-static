name: Test Secrets Configuration

on:
  workflow_dispatch: {}

jobs:
  test-secrets:
    runs-on: ubuntu-latest
    steps:
      - name: Test SUPABASE_PROJECT_REF
        env:
          SECRET: ${{ secrets.SUPABASE_PROJECT_REF }}
        run: |
          if [ -z "$SECRET" ]; then
            echo "❌ SUPABASE_PROJECT_REF is NOT set"
            exit 1
          else
            LEN=${#SECRET}
            echo "✓ SUPABASE_PROJECT_REF is set (length: $LEN chars)"
          fi

      - name: Test SUPABASE_DB_URL
        env:
          SECRET: ${{ secrets.SUPABASE_DB_URL }}
        run: |
          if [ -z "$SECRET" ]; then
            echo "❌ SUPABASE_DB_URL is NOT set"
            exit 1
          else
            LEN=${#SECRET}
            echo "✓ SUPABASE_DB_URL is set (length: $LEN chars)"
            # Check if it starts with postgresql://
            if [[ "$SECRET" == postgresql://* ]]; then
              echo "  Format check: ✓ starts with postgresql://"
            else
              echo "  Format check: ❌ does NOT start with postgresql://"
              exit 1
            fi
          fi

      - name: Test SUPABASE_ACCESS_TOKEN
        env:
          SECRET: ${{ secrets.SUPABASE_ACCESS_TOKEN }}
        run: |
          if [ -z "$SECRET" ]; then
            echo "❌ SUPABASE_ACCESS_TOKEN is NOT set"
            exit 1
          else
            LEN=${#SECRET}
            echo "✓ SUPABASE_ACCESS_TOKEN is set (length: $LEN chars)"
          fi

      - name: Test SUPABASE_ANON_KEY
        env:
          SECRET: ${{ secrets.SUPABASE_ANON_KEY }}
        run: |
          if [ -z "$SECRET" ]; then
            echo "❌ SUPABASE_ANON_KEY is NOT set"
            exit 1
          else
            LEN=${#SECRET}
            echo "✓ SUPABASE_ANON_KEY is set (length: $LEN chars)"
          fi

      - name: Test SUPABASE_SERVICE_ROLE_KEY
        env:
          SECRET: ${{ secrets.SUPABASE_SERVICE_ROLE_KEY }}
        run: |
          if [ -z "$SECRET" ]; then
            echo "❌ SUPABASE_SERVICE_ROLE_KEY is NOT set"
            exit 1
          else
            LEN=${#SECRET}
            echo "✓ SUPABASE_SERVICE_ROLE_KEY is set (length: $LEN chars)"
          fi

      - name: Test SUPABASE_URL
        env:
          SECRET: ${{ secrets.SUPABASE_URL }}
        run: |
          if [ -z "$SECRET" ]; then
            echo "❌ SUPABASE_URL is NOT set"
            exit 1
          else
            LEN=${#SECRET}
            echo "✓ SUPABASE_URL is set (length: $LEN chars)"
            # Check if it starts with https://
            if [[ "$SECRET" == https://* ]]; then
              echo "  Format check: ✓ starts with https://"
            else
              echo "  Format check: ❌ does NOT start with https://"
              exit 1
            fi
          fi

      - name: Test SUPABASE_FUNCTIONS_URL
        env:
          SECRET: ${{ secrets.SUPABASE_FUNCTIONS_URL }}
        run: |
          if [ -z "$SECRET" ]; then
            echo "❌ SUPABASE_FUNCTIONS_URL is NOT set"
            exit 1
          else
            LEN=${#SECRET}
            echo "✓ SUPABASE_FUNCTIONS_URL is set (length: $LEN chars)"
          fi

      - name: Test HCAPTCHA_SECRET_KEY
        env:
          SECRET: ${{ secrets.HCAPTCHA_SECRET_KEY }}
        run: |
          if [ -z "$SECRET" ]; then
            echo "❌ HCAPTCHA_SECRET_KEY is NOT set"
            exit 1
          else
            LEN=${#SECRET}
            echo "✓ HCAPTCHA_SECRET_KEY is set (length: $LEN chars)"
          fi

      - name: Test RZ_KEY
        env:
          SECRET: ${{ secrets.RZ_KEY }}
        run: |
          if [ -z "$SECRET" ]; then
            echo "❌ RZ_KEY is NOT set"
            exit 1
          else
            LEN=${#SECRET}
            echo "✓ RZ_KEY is set (length: $LEN chars)"
          fi

      - name: Test RZ_SECRET
        env:
          SECRET: ${{ secrets.RZ_SECRET }}
        run: |
          if [ -z "$SECRET" ]; then
            echo "❌ RZ_SECRET is NOT set"
            exit 1
          else
            LEN=${#SECRET}
            echo "✓ RZ_SECRET is set (length: $LEN chars)"
          fi

      - name: Summary
        run: |
          echo ""
          echo "========================================="
          echo "✓ All critical secrets are configured!"
          echo "========================================="
