name: SFTP/SSH Deploy Only (manual)

on:
  workflow_dispatch:

jobs:
  sftp-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout (SSH)
        uses: actions/checkout@v4
        with:
          persist-credentials: false
          ssh-key: ${{ secrets.CHECKOUT_SSH_KEY }}
          submodules: false

      - name: Build & copy to dist
        run: |
          rm -rf dist || true
          mkdir -p dist
          rsync -av --exclude='.git' --exclude='.github' --exclude='node_modules' --exclude='dist' ./ dist/

      - name: Deploy over SSH (rsync with delete)
        uses: easingthemes/ssh-deploy@v4
        with:
          # SSH key for authentication (recommended)
          SSH_PRIVATE_KEY: ${{ secrets.SSH_PRIVATE_KEY }}
          REMOTE_USER: ${{ secrets.SSH_USER }}
          REMOTE_HOST: ${{ secrets.SSH_HOST }}
          REMOTE_PORT: 22
          # Paths
          SOURCE: dist/
          TARGET: /public_html/
          # Remove remote files not present locally
          ARGS: -avz --delete

# Required secrets for SSH deploy:
# - SSH_PRIVATE_KEY (private key content)
# - SSH_USER (e.g. your cPanel/SSH username)
# - SSH_HOST (server hostname or IP)
# For SSH checkout (actions/checkout with SSH):
# - CHECKOUT_SSH_KEY (private key PEM; add its public key as a Deploy Key with read access in this repo)
# Optional:
# - To change port, set 'ssh-port' above (default 22)
