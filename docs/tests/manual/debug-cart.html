<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Security Meta Tags -->
    <meta http-equiv="X-Frame-Options" content="SAMEORIGIN">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <meta name="referrer" content="strict-origin-when-cross-origin">
    <title>Cart Debug Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
        .test { padding: 15px; margin: 10px 0; border-radius: 8px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; background: #FF6B00; color: white; border: none; border-radius: 6px; }
        pre { background: #f4f4f4; padding: 10px; border-radius: 4px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>üîç Cart Functionality Debug</h1>
    <div id="results"></div>
    
    <h2>Test Buttons:</h2>
    <button onclick="testAddToCart()">Test Add to Cart</button>
    <button onclick="checkCartState()">Check Cart State</button>
    <button onclick="viewConsole()">View Console Logs</button>

    <!-- Supabase Integration -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="../../../js/supabase-config.js"></script>
    <script src="../../../js/supabase-service.js"></script>
    <script src="../../../js/main.js"></script>

    <script>
        const results = document.getElementById('results');

        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `test ${type}`;
            div.innerHTML = message;
            results.appendChild(div);
        }

        // Capture console errors
        window.onerror = function(msg, url, lineNo, columnNo, error) {
            log(`‚ùå JavaScript Error: ${msg}<br>File: ${url}<br>Line: ${lineNo}`, 'error');
            return false;
        };

        // Check on page load
        window.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                log('üîç Checking cart functionality...', 'info');
                
                // Check if Supabase is loaded
                if (window.getSupabase) {
                    log('‚úÖ Supabase functions available', 'success');
                } else {
                    log('‚ùå Supabase functions NOT available', 'error');
                }

                // Check if main.js functions exist
                if (typeof addToCart === 'function') {
                    log('‚úÖ addToCart function found in main.js', 'success');
                } else {
                    log('‚ùå addToCart function NOT found', 'error');
                }

                // Check cart in localStorage
                const cart = localStorage.getItem('ace1_cart');
                if (cart) {
                    log(`üì¶ Cart in localStorage: ${cart}`, 'info');
                } else {
                    log('üì¶ No cart in localStorage (this is okay)', 'info');
                }

                // Check for console errors
                log('Check browser console (F12) for any errors', 'info');
            }, 1000);
        });

        function testAddToCart() {
            log('Testing add to cart...', 'info');
            
            try {
                // Test product data
                const testProduct = {
                    id: 1,
                    name: 'Test Product',
                    price: 999,
                    image: 'test.jpg'
                };

                // Try to add using the function from main.js
                if (typeof addToCart === 'function') {
                    addToCart(testProduct);
                    log('‚úÖ addToCart function called successfully', 'success');
                    
                    // Check if it was added
                    const cart = JSON.parse(localStorage.getItem('ace1_cart') || '[]');
                    log(`Cart now has ${cart.length} items`, cart.length > 0 ? 'success' : 'error');
                    log('<pre>' + JSON.stringify(cart, null, 2) + '</pre>', 'info');
                } else {
                    log('‚ùå addToCart function not available', 'error');
                    log('This means main.js is not loading properly', 'error');
                }
            } catch (error) {
                log(`‚ùå Error: ${error.message}`, 'error');
            }
        }

        function checkCartState() {
            log('Checking cart state...', 'info');
            
            const cart = JSON.parse(localStorage.getItem('ace1_cart') || '[]');
            log(`üìä Cart has ${cart.length} items`, 'info');
            
            if (cart.length > 0) {
                log('<pre>' + JSON.stringify(cart, null, 2) + '</pre>', 'success');
            } else {
                log('Cart is empty', 'info');
            }
        }

        function viewConsole() {
            log('üì± Open browser console (F12) to see detailed logs', 'info');
            console.log('=== Cart Debug Info ===');
            console.log('Supabase available:', !!window.getSupabase);
            console.log('addToCart function:', typeof addToCart);
            console.log('Cart contents:', JSON.parse(localStorage.getItem('ace1_cart') || '[]'));
            console.log('Supabase service:', window.supabaseService);
        }
    </script>
    <!-- Image Optimization -->
    <script src="../../../js/image-optimizer.js"></script>

</body>
</html>
